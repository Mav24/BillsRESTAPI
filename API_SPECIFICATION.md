# REST API Specification for MonthlyBillCalculator

This document describes the REST API endpoints that you need to create to replace the mockapi.io service currently used by the MonthlyBillCalculator application.

## Overview

The MonthlyBillCalculator .NET MAUI application consumes a REST API for bill management. This document provides the complete specification for creating your own REST API backend.

## Base URL

Configure your API with a base URL. The current mockapi.io base URL is:
```
https://694c8947da5ddabf0036ecbb.mockapi.io
```

Replace this with your own API's base URL in `/MonthlyBillCalculator/MVVM/ViewModels/AddBillsViewModel.cs`.

---

## Data Models

### Bills

The primary data model used in the application.

| Field | Type | Description | Required |
|-------|------|-------------|----------|
| `id` | integer | Unique identifier (auto-generated by API) | Auto |
| `billName` | string | Name/description of the bill (e.g., "Electricity", "Gas", "Water") | Yes |
| `amount` | decimal | The full bill amount | Yes |
| `date` | datetime | Date of the bill (ISO 8601 format: `YYYY-MM-DDTHH:mm:ss`) | Yes |
| `amountOverMinimum` | decimal | Amount over the minimum threshold (user-entered value) | No (default: 0) |

**JSON Example:**
```json
{
  "id": 1,
  "billName": "Electricity",
  "amount": 125.50,
  "date": "2024-01-15T00:00:00",
  "amountOverMinimum": 20.50
}
```

---

## API Endpoints

### 1. Get All Bills

Retrieves all bills from the database.

**Request:**
```
GET /bills
```

**Response:** `200 OK`
```json
[
  {
    "id": 1,
    "billName": "Electricity",
    "amount": 125.50,
    "date": "2024-01-15T00:00:00",
    "amountOverMinimum": 20.50
  },
  {
    "id": 2,
    "billName": "Gas",
    "amount": 65.00,
    "date": "2024-01-10T00:00:00",
    "amountOverMinimum": 0.00
  }
]
```

**Response (empty):** `200 OK`
```json
[]
```

---

### 2. Get Single Bill by ID

Retrieves a specific bill by its ID.

**Request:**
```
GET /bills/{id}
```

**Path Parameters:**
- `id` (integer): The unique identifier of the bill

**Response:** `200 OK`
```json
{
  "id": 1,
  "billName": "Electricity",
  "amount": 125.50,
  "date": "2024-01-15T00:00:00",
  "amountOverMinimum": 20.50
}
```

**Response (not found):** `404 Not Found`
```json
{
  "error": "Bill not found"
}
```

---

### 3. Create Bill

Creates a new bill entry.

**Request:**
```
POST /bills
Content-Type: application/json
```

**Request Body:**
```json
{
  "billName": "Water",
  "amount": 210.00,
  "date": "2024-01-20T00:00:00",
  "amountOverMinimum": 0.00
}
```

**Response:** `201 Created`
```json
{
  "id": 3,
  "billName": "Water",
  "amount": 210.00,
  "date": "2024-01-20T00:00:00",
  "amountOverMinimum": 0.00
}
```

---

### 4. Update Bill (Optional - Not Currently Used)

Updates an existing bill. This endpoint is not currently used by the application but may be useful for future features.

**Request:**
```
PUT /bills/{id}
Content-Type: application/json
```

**Path Parameters:**
- `id` (integer): The unique identifier of the bill

**Request Body:**
```json
{
  "billName": "Water",
  "amount": 220.00,
  "date": "2024-01-20T00:00:00",
  "amountOverMinimum": 10.00
}
```

**Response:** `200 OK`
```json
{
  "id": 3,
  "billName": "Water",
  "amount": 220.00,
  "date": "2024-01-20T00:00:00",
  "amountOverMinimum": 10.00
}
```

---

### 5. Delete Bill (Optional - Not Currently Used via API)

Deletes a bill by its ID. This endpoint is not currently used via the API (deletion happens locally), but may be useful for future features.

**Request:**
```
DELETE /bills/{id}
```

**Path Parameters:**
- `id` (integer): The unique identifier of the bill

**Response:** `200 OK` or `204 No Content`

---

## Implementation Notes

### Technology Recommendations

You can implement this REST API using various technologies:

1. **ASP.NET Core Web API** (Recommended for .NET developers)
   - Use Entity Framework Core for database access
   - Easy integration with the existing .NET MAUI codebase

2. **Node.js with Express**
   - Quick setup with `express` and a database like MongoDB or PostgreSQL

3. **Python with FastAPI or Flask**
   - Rapid development with automatic OpenAPI documentation

4. **Azure Functions or AWS Lambda**
   - Serverless approach for minimal infrastructure management

### Database Schema

If using a relational database, here's a suggested table structure:

```sql
CREATE TABLE Bills (
    ID INT PRIMARY KEY IDENTITY(1,1),
    BillName NVARCHAR(100) NOT NULL,
    Amount DECIMAL(18,2) NOT NULL,
    Date DATETIME NOT NULL,
    AmountOverMinimum DECIMAL(18,2) DEFAULT 0
);
```

### CORS Configuration

The API must allow Cross-Origin Resource Sharing (CORS) to enable the application to make requests. Configure your API to allow:
- All origins (for development) or your specific app's origin
- HTTP methods: `GET`, `POST`, `PUT`, `DELETE`
- Headers: `Content-Type`, `Accept`

### JSON Serialization

The application uses `System.Text.Json` for serialization with the following options:
- Property names should be camelCase or match the C# property names exactly
- Dates should be in ISO 8601 format

### Updating the Application

After creating your API, update the base URL in `AddBillsViewModel.cs`:

```csharp
// Change from:
string baseUrl = "https://694c8947da5ddabf0036ecbb.mockapi.io";

// To your API URL:
string baseUrl = "https://your-api-domain.com/api";
```

---

## Additional Models (For Future Expansion)

The application also uses these local models that could be exposed via API for full synchronization:

### BillMinimums

| Field | Type | Description |
|-------|------|-------------|
| `id` | integer | Unique identifier |
| `billType` | string | Type of bill (e.g., "Electricity", "Gas", "Water") |
| `minimumAmount` | decimal | The minimum expected amount for this bill type |

### MonthlyPaymentStatus

| Field | Type | Description |
|-------|------|-------------|
| `id` | integer | Unique identifier |
| `monthKey` | string | Month identifier in format "yyyy-MM" (e.g., "2024-01") |
| `isPaid` | boolean | Whether the month's bills have been paid |
| `createdDate` | datetime | When the record was created |
| `modifiedDate` | datetime | When the record was last modified (nullable) |

---

## Quick Start Example (ASP.NET Core Minimal API)

Here's a minimal example to get started with ASP.NET Core:

```csharp
// Program.cs
var builder = WebApplication.CreateBuilder(args);
builder.Services.AddCors();

var app = builder.Build();

// IMPORTANT: For production, restrict CORS to specific origins:
// app.UseCors(policy => policy.WithOrigins("https://your-app-domain.com")
//     .WithMethods("GET", "POST", "PUT", "DELETE")
//     .WithHeaders("Content-Type", "Accept"));
// The following is for development only:
app.UseCors(policy => policy.AllowAnyOrigin().AllowAnyMethod().AllowAnyHeader());

var bills = new List<Bill>();
var nextId = 1;

app.MapGet("/bills", () => bills);

app.MapGet("/bills/{id}", (int id) => 
    bills.FirstOrDefault(b => b.Id == id) is Bill bill 
        ? Results.Ok(bill) 
        : Results.NotFound());

app.MapPost("/bills", (BillInput input) =>
{
    var newBill = new Bill(nextId++, input.BillName, input.Amount, input.Date, input.AmountOverMinimum);
    bills.Add(newBill);
    return Results.Created($"/bills/{newBill.Id}", newBill);
});

app.Run();

// Immutable record for stored bills
record Bill(int Id, string BillName, decimal Amount, DateTime Date, decimal AmountOverMinimum);

// Input DTO for creating bills (without Id)
record BillInput(string BillName, decimal Amount, DateTime Date, decimal AmountOverMinimum);
```

---

## Summary

To create your own REST API for the MonthlyBillCalculator application, you need to implement:

| Endpoint | Method | Status | Description |
|----------|--------|--------|-------------|
| `/bills` | GET | Required | List all bills |
| `/bills/{id}` | GET | Required | Get a specific bill |
| `/bills` | POST | Required | Create a new bill |
| `/bills/{id}` | PUT | Optional | Update an existing bill |
| `/bills/{id}` | DELETE | Optional | Delete a bill |

The minimum viable implementation requires only the `GET /bills`, `GET /bills/{id}`, and `POST /bills` endpoints.
